---
title: "indipendent_proj"
author: "siddhant jain"
date: "06/01/2021"
output: html_document
---



```{r setup, include=FALSE}
needed_packages <- c("foreign",  "lm.beta", "stargazer", "ppcor","pastecs", "ggplot2", "semTools", "FSA", "sjstats", "userfriendlyscience",  "Epi", "arm", "DescTools", "lmtest",  "car", "generalhoslem", "regclass","psych",  "REdaS", "Hmisc", "corrplot", "ggcorrplot", "factoextra",  "nFactors", "HDclassif", "ggplot2", "dplyr", "reshape", "sqldf", "stringr","moments")                     
# Extract not installed packages
not_installed <- needed_packages[!(needed_packages %in% installed.packages()[ , "Package"])]    
# Install not installed packages
if(length(not_installed)) install.packages(not_installed, repos = "http://cran.us.r-project.org") 

```
load libraries 

```{r}
library(readxl)
library(lm.beta)
library(stargazer)
library(ppcor)
library(pastecs)
library(sjstats)
library(userfriendlyscience)
library(lmtest)
library(car)
library(generalhoslem)
library(regclass)
library(psych)
library(corrplot)
library(ggcorrplot)
library(ggplot2)
library(dplyr)
library(reshape)
library(sqldf)
library(stringr)
library(semTools)
```
#load table 
Here we will load the table and convert it into data frame
```{r}
acadmic_performance<- read_excel("C:/Users/siddh/Documents/R_WD/data_academic_performance.xlsx")
acadmic_performance_df<- as.data.frame(acadmic_performance)
```

## Remove columns 
After loading data we will remove all the unwanted column as we are not going to use them in analysis

```{r}
names(acadmic_performance_df)[10]<-paste("blank_col")
names(acadmic_performance_df)[42]<-paste("snd_DECILE")
acadmic_performance_filtered <- subset(acadmic_performance_df,select = -c(SEL_IHE,blank_col,REVENUE,SISBEN,SEL,snd_DECILE))
```

#null check

now we will assess missingness of data for that we will check how many columns are NA or null .As in this data we can see some column as 0 written in place of string. also Not sure  is also considered as null.
```{r}
#check null 
sum(is.na(acadmic_performance_filtered))
#not sure and 0 are equal to null lets convert them into null 
acadmic_performance_cleaned<- na_if(acadmic_performance_filtered,"Not sure")
acadmic_performance_cleaned$EDU_FATHER <- na_if(acadmic_performance_filtered$EDU_FATHER,"0")
acadmic_performance_cleaned$EDU_MOTHER <- na_if(acadmic_performance_filtered$EDU_MOTHER,"0")
acadmic_performance_cleaned$OCC_FATHER <- na_if(acadmic_performance_filtered$OCC_FATHER,"0")
acadmic_performance_cleaned$OCC_MOTHER <- na_if(acadmic_performance_filtered$OCC_MOTHER,"0")
acadmic_performance_cleaned$JOB <- na_if(acadmic_performance_filtered$JOB,"0")
#CHECK NULL AGAIN  
 sum(is.na(acadmic_performance_cleaned))
 
null_columns<-lapply(acadmic_performance_cleaned, function(y) sum(length(which(is.na(y)))))
null_columns               
null_columns_percent<-lapply(acadmic_performance_cleaned, function(y) round(sum(is.na(y)*100)/length(y))) 
null_columns_percent

#father has more then 5 percent null lets remove all the rows with null
acadmic_performance_cleaned<-na.omit(acadmic_performance_cleaned)
```
Access frequency of categorical  variable of interest  

```{r}
local({
  .Table <- with(acadmic_performance_cleaned, table(INTERNET))
  cat("\ncounts:\n")
  print(.Table)
  cat("\npercentages:\n")
  print(round(100*.Table/sum(.Table), 2))
})
local({
  .Table <- with(acadmic_performance_cleaned, table(MOBILE))
  cat("\ncounts:\n")
  print(.Table)
  cat("\npercentages:\n")
  print(round(100*.Table/sum(.Table), 2))
})
local({
  .Table <- with(acadmic_performance_cleaned, table(SCHOOL_NAT))
  cat("\ncounts:\n")
  print(.Table)
  cat("\npercentages:\n")
  print(round(100*.Table/sum(.Table), 2))
})
```

create histogram for frequency of maths 
```{r}
with(acadmic_performance_cleaned, Hist(MAT_S11, scale="frequency", 
  breaks="Sturges", col="darkgray"))
```




# assess normality 

now we will assess normality for that we will go through 3 different steps 


step 1 - density bell  curve 

```{r}
gg <- ggplot(acadmic_performance_cleaned, aes(x=MAT_S11))
 gg <- gg + labs(x="Mathematics final grade")
 gg <- gg + geom_histogram(binwidth=2, colour="black", aes(y=..density.., fill=..count..))
 gg <- gg + scale_fill_gradient("Count", low="blue", high="#7C7C7C")
#adding density curve
 gg <- gg + stat_function(fun=dnorm, color="red",args=list(mean=mean(acadmic_performance_cleaned$MAT_S11, na.rm=TRUE), sd=sd(acadmic_performance_cleaned$MAT_S11, na.rm=TRUE)))
 gg

```
step 2 qq plot to check data allighment  


```{r}
qqnorm(acadmic_performance_cleaned$MAT_S11)
qqline(acadmic_performance_cleaned$MAT_S11, col=2)
```

3) data summary 

```{r}
pastecs::stat.desc(acadmic_performance_cleaned$MAT_S11, basic=F)
```
4) now we will check skewness and kurtosis 

```{r}
MAT_S11_skew<-semTools::skew(acadmic_performance_cleaned$MAT_S11)
MAT_S11_skew[1]/MAT_S11_skew[2]

MAT_S11_kurt<-semTools::kurtosis(acadmic_performance_cleaned$MAT_S11)
MAT_S11_kurt[1]/MAT_S11_kurt[2]
```

5) lastly we will check Z score to know whether it is under 3.29 or not 
```{r}
z_MAT_S11<- abs(scale(acadmic_performance_cleaned$MAT_S11))

FSA::perc(as.numeric(z_MAT_S11), 1.96, "gt")
FSA::perc(as.numeric(z_MAT_S11), 3.29, "gt")
```

corelation of maths to genereral scores 

```{r}
#below code is used to create scatter plot 
scatter <- ggplot(acadmic_performance_cleaned, aes(G_SC, MAT_S11))
#below code used to draw regression line 
 scatter + geom_point() + geom_smooth(method = "lm", colour = "Red", se = F) + labs(x = "Final Grades", y = "grades for first period ")
```


lets calculate corelation value 
```{r}
 stats::cor.test(acadmic_performance_cleaned$G_SC, acadmic_performance_cleaned$MAT_S11, method='pearson')
```

# H0 = The student who got internet connection at home doesnot score more marks then the student without internet, mobile and nature of school  .

# Ha = The student who got internet connection at home  score more marks then the student without internet mobile and nature of school .


```{r}
 psych::describeBy(acadmic_performance_cleaned$G_SC, acadmic_performance_cleaned$INTERNET, mat=TRUE)
psych::describeBy(acadmic_performance_cleaned$G_SC, acadmic_performance_cleaned$MOBILE, mat=TRUE)
psych::describeBy(acadmic_performance_cleaned$G_SC, acadmic_performance_cleaned$SCHOOL_NAT, mat=TRUE)
```

levene test 

```{r}
 car::leveneTest(G_SC ~ INTERNET, data=acadmic_performance_cleaned)
 car::leveneTest(G_SC ~ MOBILE, data=acadmic_performance_cleaned)
 car::leveneTest(G_SC ~ SCHOOL_NAT, data=acadmic_performance_cleaned)
```

T- test 

```{r}
  stats::t.test(G_SC~INTERNET,var.equal=TRUE,data=acadmic_performance_cleaned)
  stats::t.test(G_SC~SCHOOL_NAT,var.equal=TRUE,data=acadmic_performance_cleaned)
    stats::t.test(G_SC~MOBILE,var.equal=TRUE,data=acadmic_performance_cleaned)
```

effect size for INTERNET

```{r}
paid <- stats::t.test(G_SC~INTERNET,var.equal=TRUE,data=acadmic_performance_cleaned)
  
effcd=round((2*paid$statistic)/sqrt(paid$parameter),2)
effectsize::t_to_d(t = paid$statistic, paid$parameter)
effes=round((paid$statistic*paid$statistic)/((paid$statistic*paid$statistic)+(paid$parameter)),3)
effes
effcd
```

effect size for Moblie 
```{r}
paid2 <- stats::t.test(G_SC~MOBILE,var.equal=TRUE,data=acadmic_performance_cleaned)
  
effcd2=round((2*paid2$statistic)/sqrt(paid2$parameter),2)
effectsize::t_to_d(t = paid2$statistic, paid2$parameter)
effes2=round((paid2$statistic*paid2$statistic)/((paid2$statistic*paid2$statistic)+(paid2$parameter)),3)
effes2
effcd2
```

effect size for nature of school 

```{r}
paid <- stats::t.test(G_SC~SCHOOL_NAT,var.equal=TRUE,data=acadmic_performance_cleaned)
  
effcd=round((2*paid$statistic)/sqrt(paid$parameter),2)
effectsize::t_to_d(t = paid$statistic, paid$parameter)
effes=round((paid$statistic*paid$statistic)/((paid$statistic*paid$statistic)+(paid$parameter)),3)
effes
effcd
```


test homogenety barnet test 
```{r}
stats::bartlett.test(G_SC~ INTERNET, data=acadmic_performance_cleaned)
stats::bartlett.test(G_SC~ MOBILE, data=acadmic_performance_cleaned)
stats::bartlett.test(G_SC~ SCHOOL_NAT, data=acadmic_performance_cleaned)
```

creation of model with maths score  and usage of internet.

```{r}
model1<-lm(acadmic_performance_cleaned$G_SC~acadmic_performance_cleaned$MAT_S11+acadmic_performance_cleaned$INTERNET)
lm.beta::lm.beta(model1)
stargazer(model1, type="text")
```

summary of model 

```{r}
summary(model1)
```

cook value 
```{r}
 cooksd<-sort(cooks.distance(model1))
plot(cooksd, pch="*", cex=2, main="Influential Obs by Cooks distance")  
abline(h = 4*mean(cooksd, na.rm=T), col="red")  # add cutoff line
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=T),names(cooksd),""), col="red")
```

influential rows 

```{r}
influential <- as.numeric(names(cooksd)[(cooksd > 4*mean(cooksd, na.rm=T))])
influential
stem(influential)
```

outlier test

```{r}
car::outlierTest(model1)
```
plot the leverage plot 


```{r}
car::leveragePlots(model1)
```

Check homoscedasticity 
plot 1

```{r}
plot(model1,1)
```

plot 2 

```{r}
plot(model1, 3)
```


histogram and density plot for the residual 

```{r}
plot(density(resid(model1)))
```

studentized residual 


```{r}
car::qqPlot(model1, main="QQ Plot")
```

collinearity 

```{r}
vifmodel<-car::vif(model1)
vifmodel
```

Tolerance 

```{r}
1/vifmodel
```


creation of model2  with introducing mobile phone unto model 1 .

```{r}
model2<-lm(acadmic_performance_cleaned$G_SC~acadmic_performance_cleaned$MAT_S11+acadmic_performance_cleaned$INTERNET+acadmic_performance_cleaned$MOBILE)
lm.beta::lm.beta(model2)
stargazer(model2, type="text")
```

summary of model 
  
```{r}
summary(model2)
```

cook value 
```{r}
 cooksd2<-sort(cooks.distance(model2))
plot(cooksd2, pch="*", cex=2, main="Influential Obs by Cooks distance")  
abline(h = 4*mean(cooksd2, na.rm=T), col="red")  # add cutoff line
text(x=1:length(cooksd2)+1, y=cooksd2, labels=ifelse(cooksd2>4*mean(cooksd2, na.rm=T),names(cooksd2),""), col="red")
```

influential rows 

```{r}
influential2 <- as.numeric(names(cooksd2)[(cooksd2 > 4*mean(cooksd2, na.rm=T))])
influential2
stem(influential2)
```

outlier test

```{r}
car::outlierTest(model2)
```
plot the leverage plot 


```{r}
car::leveragePlots(model2)
```

Check homoscedasticity 
plot 1

```{r}
plot(model2,1)
```

plot 2 

```{r}
plot(model2, 3)
```


histogram and density plot for the residual 

```{r}
plot(density(resid(model2)))
```

studentized residual 


```{r}
car::qqPlot(model2, main="QQ Plot")
```

collinearity 

```{r}
vifmodel2<-car::vif(model2)
vifmodel2
```

Tolerance 

```{r}
1/vifmodel2
```


model compare 


```{r}
stargazer(model1, model2, type="text") 
```



